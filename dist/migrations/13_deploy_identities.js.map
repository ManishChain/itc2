{"version":3,"file":"13_deploy_identities.js","sourceRoot":"","sources":["../../migrations/13_deploy_identities.ts"],"names":[],"mappings":"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","sourcesContent":["import { createPermission, grantPermission } from '@settlemint/enteth-migration-utils';\n\nimport { AdminRoleRegistryContract } from '../types/truffle-contracts/AdminRoleRegistry';\nimport { GateKeeperContract } from '../types/truffle-contracts/GateKeeper';\nimport { IdentityContract, IdentityInstance } from '../types/truffle-contracts/Identity';\nimport { IdentityRegistryContract } from '../types/truffle-contracts/IdentityRegistry';\nimport { UserRoleRegistryContract } from '../types/truffle-contracts/UserRoleRegistry';\n\nconst GateKeeper: GateKeeperContract = artifacts.require('GateKeeper');\nconst AdminRoleRegistry: AdminRoleRegistryContract = artifacts.require('AdminRoleRegistry');\nconst UserRoleRegistry: UserRoleRegistryContract = artifacts.require('UserRoleRegistry');\nconst IdentityRegistry: IdentityRegistryContract = artifacts.require('./IdentityRegistry.sol');\nconst Identity: IdentityContract = artifacts.require('./Identity.sol');\n\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst { storeIpfsHash, enabledFeatures } = require('../../truffle-config.js'); // two dirs up, because it is compiled into ./dist/migrations\n\nmodule.exports = async (deployer: Truffle.Deployer, network: string, accounts: string[]) => {\n  if (enabledFeatures().includes('IDENTITIES')) {\n    const dGateKeeper = await GateKeeper.deployed();\n\n    await deployer.deploy(IdentityRegistry, dGateKeeper.address);\n    const dRegistry = await IdentityRegistry.deployed();\n\n    await deployer.deploy(Identity, dGateKeeper.address);\n    const dIdentity = await Identity.deployed();\n\n    // Give UPGRADE_CONTRACT permissions to accounts[0]\n    await createPermission(dGateKeeper, dRegistry, 'UPGRADE_CONTRACT', accounts[0], accounts[0]);\n    await dRegistry.upgrade(dIdentity.address);\n\n    // Give admin permission to accounts[0]\n    await createPermission(dGateKeeper, dIdentity, 'MANAGE_DIGITALTWIN_ROLE', accounts[0], accounts[0]);\n\n    for (const roleRegistry of [AdminRoleRegistry, UserRoleRegistry]) {\n      await grantPermission(dGateKeeper, dIdentity, 'MANAGE_DIGITALTWIN_ROLE', roleRegistry.address);\n    }\n\n    // Give admin permission to accounts[0]\n    await createPermission(dGateKeeper, dIdentity, 'UPDATE_UIFIELDDEFINITIONS_ROLE', accounts[0], accounts[0]);\n\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    const uiDefinitions = require('../../contracts/identity/UIDefinitions.json');\n\n    if (Object.keys(uiDefinitions).length) {\n      const hash = await storeIpfsHash(uiDefinitions);\n      await dIdentity.setUIFieldDefinitionsHash(hash);\n    }\n\n    const identities = [\n      {\n        idNumber: web3.utils.fromAscii('IN198001021112345'),\n        kind: web3.utils.fromAscii('ID CARD'),\n        ipfsFields: {\n          Nama_Lengkap: 'John Doe',\n          Tempat_Lahir: 'Denpasar',\n          Tanggal_Lahir: '11-11-1981',\n          Nama_Ibu_Kandung: 'Ingrid',\n          Jenis_Identitas: 'Standard',\n          Alamat_sesuai_ID: 'Main street 123',\n          Alamat_Tinggal_Sekarang: 'N/A',\n          Jenis_Kelamin: 'Male',\n          Kewarganegaraan: 'American',\n          Status_Kependudukan: 'resident',\n          NPWP: '123-456-789',\n          Status_Perkawinan: 'Married',\n          Agama: 'Catholic',\n          Pendidikan_Terakhir: 'Biology',\n          Alamat_Kirim_Surat: 'Main street 123',\n          Email: 'john.doe@outlook.com',\n          Telepon_Selular: '123456789',\n          Telepon_Rumah: '987654321',\n          Telepon_Kantor: 'N/A',\n          Nama_Perusahaan: 'BASF',\n          Pekerjaan_Sekarang: 'Process Engineer',\n          Alamat_Kantor: 'Station street 345',\n          Bidang_Usaha: 'Research',\n          Jabatan: 'Employee',\n          Divisi: 'Research',\n          Tangal_Mulai_Bekerja: '01-01-2010',\n          Status_Pekerjaan: 'Employed',\n          Sumber_Dana: '2 million rupiah',\n          Penghasilan_Rerata: '25 million rupiah',\n          Maksud_dan_Tujuan_Berhububungan_dgn_Bank: 'Loan',\n        },\n      },\n    ];\n    for (const identity of identities) {\n      await createIdentity(dIdentity, identity);\n    }\n  }\n};\n\nasync function createIdentity(identityInstance: IdentityInstance, identityData: IIdentityData) {\n  const ipfsHash = await storeIpfsHash(identityData.ipfsFields);\n\n  await identityInstance.create(identityData.idNumber, identityData.kind, ipfsHash);\n}\n\ninterface IIdentityData {\n  idNumber: string;\n  kind: string;\n  ipfsFields: {\n    Nama_Lengkap: string;\n    Tempat_Lahir: string;\n    Tanggal_Lahir: string;\n    Nama_Ibu_Kandung: string;\n    Jenis_Identitas: string;\n    Alamat_sesuai_ID: string;\n    Alamat_Tinggal_Sekarang: string;\n    Jenis_Kelamin: string;\n    Kewarganegaraan: string;\n    Status_Kependudukan: string;\n    NPWP: string;\n    Status_Perkawinan: string;\n    Agama: string;\n    Pendidikan_Terakhir: string;\n    Alamat_Kirim_Surat: string;\n    Email: string;\n    Telepon_Selular: string;\n    Telepon_Rumah: string;\n    Telepon_Kantor: string;\n    Nama_Perusahaan: string;\n    Pekerjaan_Sekarang: string;\n    Alamat_Kantor: string;\n    Bidang_Usaha: string;\n    Jabatan: string;\n    Divisi: string;\n    Tangal_Mulai_Bekerja: string;\n    Status_Pekerjaan: string;\n    Sumber_Dana: string;\n    Penghasilan_Rerata: string;\n    Maksud_dan_Tujuan_Berhububungan_dgn_Bank: string;\n  };\n}\n"]}